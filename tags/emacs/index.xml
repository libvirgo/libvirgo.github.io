<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Emacs on Rabbit hole</title><link>/tags/emacs/</link><description>Recent content in Emacs on Rabbit hole</description><generator>Hugo -- gohugo.io</generator><lastBuildDate>Tue, 13 Dec 2022 20:22:00 +0800</lastBuildDate><atom:link href="/tags/emacs/index.xml" rel="self" type="application/rss+xml"/><item><title>Emacs Rabbit Hole - 1</title><link>/post/emacs_rabbit_hole_1/</link><pubDate>Tue, 13 Dec 2022 20:22:00 +0800</pubDate><guid>/post/emacs_rabbit_hole_1/</guid><description>&lt;blockquote>
&lt;p>由于 &lt;code>GoLand&lt;/code> 在 &lt;code>M1&lt;/code> 的笔记本外接显示器上会屏幕闪烁, 所以重拾 &lt;code>Emacs&lt;/code>. 记录这次配置 &lt;code>Emacs&lt;/code> 的一些坑.&lt;/p>
&lt;/blockquote>
&lt;h1 id="中文字体">中文字体&lt;/h1>
&lt;p>如果没有配置等宽等高的中文字体, 会在同时显示中英文的时候出现屏幕跳动, 补全的 &lt;code>childframe&lt;/code> 显示错位之类的问题, 个人由于 &lt;code>GoLand&lt;/code> 字体看习惯了, 所以依然使用 &lt;code>JetBrainsMono&lt;/code> 作为应为字体, 中文字体选用 &lt;a class="link" href="https://github.com/be5invis/Sarasa-Gothic" target="_blank" rel="noopener"
>更莎黑体&lt;/a>.&lt;/p>
&lt;p>显示效果如图:&lt;/p>
&lt;p>&lt;img src="/post/emacs_rabbit_hole_1/corfu_english_helper.png"
width="1366"
height="894"
srcset="/post/emacs_rabbit_hole_1/corfu_english_helper_hu85355849b69732470b0aa0e3d241250a_236220_480x0_resize_box_3.png 480w, /post/emacs_rabbit_hole_1/corfu_english_helper_hu85355849b69732470b0aa0e3d241250a_236220_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="corfu_english_helper"
class="gallery-image"
data-flex-grow="152"
data-flex-basis="366px"
>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-lisp" data-lang="lisp">&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="nb">defun&lt;/span> &lt;span class="nv">+my/better-font&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">interactive&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">;; english font&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">display-graphic-p&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="k">progn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">set-face-attribute&lt;/span> &lt;span class="ss">&amp;#39;default&lt;/span> &lt;span class="no">nil&lt;/span> &lt;span class="ss">:font&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nf">format&lt;/span> &lt;span class="s">&amp;#34;%s:pixelsize=%d&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;JetBrainsMono NF&amp;#34;&lt;/span> &lt;span class="mi">15&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">;; chinese font&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nb">dolist&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">charset&lt;/span> &lt;span class="o">&amp;#39;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">kana&lt;/span> &lt;span class="nv">han&lt;/span> &lt;span class="nc">symbol&lt;/span> &lt;span class="nv">cjk-misc&lt;/span> &lt;span class="nv">bopomofo&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">set-fontset-font&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">frame-parameter&lt;/span> &lt;span class="no">nil&lt;/span> &lt;span class="ss">&amp;#39;font&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">charset&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">font-spec&lt;/span> &lt;span class="ss">:family&lt;/span> &lt;span class="s">&amp;#34;Sarasa Mono SC&amp;#34;&lt;/span>&lt;span class="p">))))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="nb">defun&lt;/span> &lt;span class="nv">+my|init-font(frame)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv"> (with-selected-frame frame
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv"> (if (display-graphic-p)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv"> (+my/better-font))))
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">(add-hook &amp;#39;after-make-frame-functions #&amp;#39;+my|init-font&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="nv">+my/better-font&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="environment">Environment&lt;/h1>
&lt;p>个人使用了 &lt;a class="link" href="https://github.com/d12frosted/homebrew-emacs-plus" target="_blank" rel="noopener"
>Emacs Plus&lt;/a> 进行编译的, 会读取 &lt;code>login shell&lt;/code> 中的 &lt;code>PATH&lt;/code> 环境变量, 如 &lt;code>.zprofile&lt;/code> &lt;code>.profile&lt;/code> 文件中配置的环境变量, 但是其它的环境变量实测没有主动获取, 所以不得已还是选择使用 &lt;code>exec-path-from-shell&lt;/code> 获取需要用到的环境变量.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-lisp" data-lang="lisp">&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="k">if&lt;/span> &lt;span class="nv">is-darwin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nf">use-package&lt;/span> &lt;span class="nv">exec-path-from-shell&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="ss">:defer&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="ss">:straight&lt;/span> &lt;span class="no">t&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="ss">:config&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="k">setq&lt;/span> &lt;span class="nv">exec-path-from-shell-variables&lt;/span> &lt;span class="o">&amp;#39;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;PATH&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;PYTHONPATH&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;GOPATH&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;GTAGSOBJDIRPREFIX&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;GTAGSCONF&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;GTAGSLABEL&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="k">setq&lt;/span> &lt;span class="nv">exec-path-from-shell-check-startup-files&lt;/span> &lt;span class="no">nil&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="k">setq&lt;/span> &lt;span class="nv">exec-path-from-shell-arguments&lt;/span> &lt;span class="o">&amp;#39;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;-l&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">exec-path-from-shell-initialize&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="k">setq&lt;/span> &lt;span class="nv">dired-use-ls-dired&lt;/span> &lt;span class="no">nil&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">;; 不设置该行的话会在使用dired的时候报错.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="project">Project&lt;/h1>
&lt;p>自带的 &lt;code>project.el&lt;/code> 包使用了系统默认的 &lt;code>grep&lt;/code> 和 &lt;code>find&lt;/code> 分别作为全局查找和文件查找的工具, 这两个工具不如 &lt;code>ripgrep&lt;/code> 和 &lt;code>fd&lt;/code> 好用. &lt;code>ripgrep&lt;/code> 和 &lt;code>fd&lt;/code> 会从 &lt;code>.gitignore&lt;/code> 中读取不需要搜索的文件, 所以以下配置可以修改默认 &lt;code>project.el&lt;/code> 的行为.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-lisp" data-lang="lisp">&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="nf">use-package&lt;/span> &lt;span class="nv">project&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="ss">:straight&lt;/span> &lt;span class="no">t&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="ss">:bind&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="s">&amp;#34;C-c p p&amp;#34;&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="nv">project-switch-project&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;C-c p f&amp;#34;&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="nv">project-find-file&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;C-c p g&amp;#34;&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="nv">project-find-regexp&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;C-c p b&amp;#34;&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="nv">consult-project-buffer&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;C-c p s&amp;#34;&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="nv">magit-project-status&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="ss">:init&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="k">setq&lt;/span> &lt;span class="nv">project-list-file&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">expand-file-name&lt;/span> &lt;span class="s">&amp;#34;projects&amp;#34;&lt;/span> &lt;span class="nv">prelude-local-dir&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="ss">:config&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">defcustom&lt;/span> &lt;span class="nv">project-root-markers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;#39;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Cargo.toml&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;go.mod&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;package.json&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;.git&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;Files or directories that indicate the root of a project.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="ss">:type&lt;/span> &lt;span class="o">&amp;#39;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">repeat&lt;/span> &lt;span class="nc">string&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="ss">:group&lt;/span> &lt;span class="ss">&amp;#39;project&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nb">defun&lt;/span> &lt;span class="nv">project-root-p&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;Check if the current PATH has any of the project root markers.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="k">catch&lt;/span> &lt;span class="ss">&amp;#39;found&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nb">dolist&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">marker&lt;/span> &lt;span class="nv">project-root-markers&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nb">when&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">file-exists-p&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">concat&lt;/span> &lt;span class="nv">path&lt;/span> &lt;span class="nv">marker&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="k">throw&lt;/span> &lt;span class="ss">&amp;#39;found&lt;/span> &lt;span class="nv">marker&lt;/span>&lt;span class="p">)))))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nb">defun&lt;/span> &lt;span class="nv">project-find-root&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;Search up the PATH for `project-root-markers&amp;#39;.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="nv">path&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">expand-file-name&lt;/span> &lt;span class="nv">path&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="k">catch&lt;/span> &lt;span class="ss">&amp;#39;found&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">while&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nf">not&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nf">equal&lt;/span> &lt;span class="s">&amp;#34;/&amp;#34;&lt;/span> &lt;span class="nv">path&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nf">not&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">project-root-p&lt;/span> &lt;span class="nv">path&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="k">setq&lt;/span> &lt;span class="nv">path&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">file-name-directory&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">directory-file-name&lt;/span> &lt;span class="nv">path&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="k">throw&lt;/span> &lt;span class="ss">&amp;#39;found&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nc">cons&lt;/span> &lt;span class="ss">&amp;#39;transient&lt;/span> &lt;span class="nv">path&lt;/span>&lt;span class="p">)))))))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">add-to-list&lt;/span> &lt;span class="ss">&amp;#39;project-find-functions&lt;/span> &lt;span class="nf">#&amp;#39;&lt;/span>&lt;span class="nv">project-find-root&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nb">defun&lt;/span> &lt;span class="nv">my/project-files-in-directory&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">dir&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;Use `fd&amp;#39; to list files in DIR.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="k">let*&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="nv">default-directory&lt;/span> &lt;span class="nv">dir&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">localdir&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">file-local-name&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">expand-file-name&lt;/span> &lt;span class="nv">dir&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">command&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nf">format&lt;/span> &lt;span class="s">&amp;#34;fd -H -t f -0 -E .git . %s&amp;#34;&lt;/span> &lt;span class="nv">localdir&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">project--remote-file-names&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nf">sort&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">split-string&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">shell-command-to-string&lt;/span> &lt;span class="nv">command&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="s">&amp;#34;\0&amp;#34;&lt;/span> &lt;span class="no">t&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">#&amp;#39;string&amp;lt;&lt;/span>&lt;span class="p">))))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">cl-defmethod&lt;/span> &lt;span class="nv">project-files&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="nv">project&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">head&lt;/span> &lt;span class="nv">transient&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="k">&amp;amp;optional&lt;/span> &lt;span class="nv">dirs&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;Override `project-files&amp;#39; to use `fd&amp;#39; in local projects.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nf">mapcan&lt;/span> &lt;span class="nf">#&amp;#39;&lt;/span>&lt;span class="nv">my/project-files-in-directory&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nb">or&lt;/span> &lt;span class="nv">dirs&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nc">list&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">project-root&lt;/span> &lt;span class="nv">project&lt;/span>&lt;span class="p">)))))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="k">setq&lt;/span> &lt;span class="nv">magit-bind-magit-project-status&lt;/span> &lt;span class="no">nil&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">define-key&lt;/span> &lt;span class="nv">project-prefix-map&lt;/span> &lt;span class="s">&amp;#34;v&amp;#34;&lt;/span> &lt;span class="nf">#&amp;#39;&lt;/span>&lt;span class="nv">vterm&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">define-key&lt;/span> &lt;span class="nv">project-prefix-map&lt;/span> &lt;span class="s">&amp;#34;m&amp;#34;&lt;/span> &lt;span class="nf">#&amp;#39;&lt;/span>&lt;span class="nv">magit-project-status&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="k">setq&lt;/span> &lt;span class="nv">project-switch-commands&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;#39;&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nv">project-find-file&lt;/span> &lt;span class="s">&amp;#34;Find file&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">project-find-regexp&lt;/span> &lt;span class="s">&amp;#34;Find ripgrep&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">project-find-dir&lt;/span> &lt;span class="s">&amp;#34;Find directory&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">vterm&lt;/span> &lt;span class="s">&amp;#34;VTerm&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">magit-project-status&lt;/span> &lt;span class="s">&amp;#34;Magit&amp;#34;&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="k">setq&lt;/span> &lt;span class="nv">xref-search-program&lt;/span> &lt;span class="ss">&amp;#39;ripgrep&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="buffer">Buffer&lt;/h1>
&lt;p>&lt;code>switch-to-next-buffer&lt;/code> 和 &lt;code>switch-to-prev-buffer&lt;/code> 可以通过 &lt;code>switch-to-prev-buffer-skip&lt;/code> 设置的函数进行过滤跳转, 大部分时候切换 &lt;code>buffer&lt;/code> 是希望在项目中的文件进行切换, 并不想切换到 &lt;code>emacs&lt;/code> 的一些包的 &lt;code>log&lt;/code> &lt;code>buffer&lt;/code>, 所以可以通过设置 &lt;code>boring-buffer-p&lt;/code> 来决定哪些 &lt;code>buffer&lt;/code> 是不想通过快捷键切出来的.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-lisp" data-lang="lisp">&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="nb">defun&lt;/span> &lt;span class="nv">project-buffer-p&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">buf&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nf">member&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">buffer-name&lt;/span> &lt;span class="nv">buf&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="nv">buffers&lt;/span> &lt;span class="p">()))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nb">dolist&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">pr&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">project-buffers&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">project-current&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nb">push&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">buffer-name&lt;/span> &lt;span class="nv">pr&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nv">buffers&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">buffers&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="nb">defun&lt;/span> &lt;span class="nv">vmacs-boring-buffer-p&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">&amp;amp;optional&lt;/span> &lt;span class="nv">buf&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">string-match-p&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">rx&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nb">or&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\*Async-native-compile-log\*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;magit&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\*company-documentation\*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\*eaf&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;\*eldoc&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;\*Launch &amp;#34;&lt;/span> &lt;span class="s">&amp;#34;*dap-&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;*EGLOT &amp;#34;&lt;/span> &lt;span class="s">&amp;#34;\*Flymake log\*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\*gopls::stderr\*&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;\*gopls\*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\*Compile-Log\*&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;*Backtrace*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;*Package-Lint*&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;\*sdcv\*&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;\*tramp&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\*lsp-log\*&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;\*tramp&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;\*Ibuffer\*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\*Help\*&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;\*ccls&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;\*vc&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\*xref&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;\*Warnings*&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;\*Http&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\*Async Shell Command\*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\*Shell Command Output\*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\*Calculator\*&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;\*Calc &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\*Flycheck error messages\*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\*Gofmt Errors\*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\*Ediff&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;\*sdcv\*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\*Org PDF LaTex Output\*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\*Org Export&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\*osx-dictionary\*&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;\*Messages\*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\*straight-process\*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">buffer-name&lt;/span> &lt;span class="nv">buf&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="nb">defun&lt;/span> &lt;span class="nv">vmacs-tab-vterm-p&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">&amp;amp;optional&lt;/span> &lt;span class="nv">buf&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nf">eq&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">buffer-local-value&lt;/span> &lt;span class="ss">&amp;#39;major-mode&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nb">or&lt;/span> &lt;span class="nv">buf&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">current-buffer&lt;/span>&lt;span class="p">)))&lt;/span> &lt;span class="ss">&amp;#39;vterm-mode&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">;; switch-to-prev-buffer 与 switch-to-next-buffer 时 skip 特定的buffers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">;;而 tab-line-switch-to-prev/next-tab 恰好使用了上面两个函数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="nb">defun&lt;/span> &lt;span class="nv">vmacs-switch-to-prev-buffer-skip&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">win&lt;/span> &lt;span class="nv">buf&lt;/span> &lt;span class="nv">bury-or-kill&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nb">when&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nf">member&lt;/span> &lt;span class="nv">this-command&lt;/span> &lt;span class="o">&amp;#39;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">next-buffer&lt;/span> &lt;span class="nv">previous-buffer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">switch-to-prev-buffer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">switch-to-next-buffer&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nb">cond&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">;; ((vmacs-tab-vterm-p) ;当前buffer是vterm&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">;; (not (vmacs-tab-vterm-p buf))) ;若buf 不是vterm,则skip&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">((&lt;/span>&lt;span class="nv">vmacs-boring-buffer-p&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">current-buffer&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nf">not&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">vmacs-boring-buffer-p&lt;/span> &lt;span class="nv">buf&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="no">t&lt;/span> &lt;span class="c1">;当前buffer是正常buffer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nb">or&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">vmacs-boring-buffer-p&lt;/span> &lt;span class="nv">buf&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">;若buf 是boring buf 或vterm，则跳过&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">vmacs-tab-vterm-p&lt;/span> &lt;span class="nv">buf&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nf">not&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">project-buffer-p&lt;/span> &lt;span class="nv">buf&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)))))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="k">setq&lt;/span> &lt;span class="nv">switch-to-prev-buffer-skip&lt;/span> &lt;span class="nf">#&amp;#39;&lt;/span>&lt;span class="nv">vmacs-switch-to-prev-buffer-skip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>